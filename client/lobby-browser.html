<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: file: http: https:; img-src 'self' data: file: http: https:; connect-src 'self' http: https: ws: wss:;">
  <title>Supraball - Lobby Browser</title>
  <link rel="stylesheet" href="styles/scrollbar.css">
  <link rel="stylesheet" href="styles/notifications.css">
  <link rel="stylesheet" href="styles/settings-popup.css">
  <link rel="stylesheet" href="styles/chat.css">
  <link rel="stylesheet" href="styles/lobby-browser.css">
  <script src="i18n.js"></script>
  <script src="scripts/config.js"></script>
  <script src="scripts/notifications.js"></script>
</head>
<body>
  <div id="notification-container"></div>
  <div class="header">
    <h1 data-i18n="lobby.browser.title">ğŸ® Supraball</h1>
    <div style="display: flex; gap: 12px; align-items: center; justify-content: space-between; flex: 1; flex-wrap: nowrap;">
      <div class="status-indicator" style="border-color: #ffc107; color: #ffc107; background: rgba(255, 193, 7, 0.2); flex-shrink: 0;">
        <div class="status-dot" style="background: #ffc107; animation: none;"></div>
        <span id="connectionStatus" data-i18n="lobby.browser.connecting">Verbindung wird hergestellt...</span>
      </div>
      <div class="header-buttons" style="display: flex; gap: 8px; align-items: center; flex-shrink: 0;">
        <button class="btn btn-secondary" id="refreshBtn" title="Aktualisieren">ğŸ”„</button>
        <button class="btn btn-primary" id="quickMatchBtn" style="background: linear-gradient(135deg, #26d0ce, #1a2980);">ğŸ¯ Quick Match</button>
        <button class="btn btn-primary" id="createLobbyBtn" data-i18n="lobby.browser.create">â• Neue Lobby</button>
        <button class="btn btn-secondary" id="settingsBtn" title="Einstellungen" style="width: 40px; padding: 8px;">âš™ï¸</button>
        <div class="language-selector">
          <select class="language-dropdown" id="languageSelect">
            <option value="de">DE</option>
            <option value="en">EN</option>
            <option value="fr">FR</option>
          </select>
        </div>
      </div>
    </div>
  </div>
  
  <div class="container">
    <div class="lobby-table">
      <table id="lobbyTable">
        <thead>
          <tr>
            <th data-i18n="table.map">Map</th>
            <th data-i18n="table.lobbyname">Lobby Name</th>
            <th data-i18n="table.players">Spieler</th>
            <th data-i18n="table.mode">Modus</th>
            <th data-i18n="table.status">Status</th>
            <th data-i18n="table.ping">Ping</th>
          </tr>
        </thead>
        <tbody id="lobbyTableBody">
          <!-- Wird dynamisch gefÃ¼llt -->
        </tbody>
      </table>
      <div id="emptyState" class="empty-state" style="display: none;">
        <h2 data-i18n="lobby.browser.empty.title">ğŸ† Keine Lobbies verfÃ¼gbar</h2>
        <p data-i18n="lobby.browser.empty.subtitle">Erstelle die erste Lobby und starte ein Match!</p>
        <button class="btn btn-primary" onclick="document.getElementById('createLobbyBtn').click()" style="margin-top: 20px;" data-i18n="lobby.browser.empty.button">
          â• Erste Lobby erstellen
        </button>
      </div>
    </div>
    
    <!-- Offline Training Button unter der Lobby-Liste -->
    <div class="offline-training-section">
      <button class="btn btn-offline" id="tutorialBtn" data-i18n="lobby.browser.tutorial">ğŸ“ Tutorial</button>
      <button class="btn btn-offline" id="offlineTrainingBtn" data-i18n="lobby.browser.offline" style="margin-left: 12px;">ğŸ¯ Offline Training</button>
      <button class="btn btn-offline" id="classicVersionBtn" style="margin-left: 12px;">ğŸ® Supraball Classic</button>
    </div>
  </div>

  <!-- Settings Popup -->
  <div class="settings-overlay" id="settingsOverlay">
    <div class="settings-popup">
      <div class="settings-header">
        <div class="settings-title" data-i18n="settings.title">âš™ï¸ Einstellungen</div>
        <button class="settings-close" id="settingsCloseBtn">Ã—</button>
      </div>
      
      <form class="settings-form" id="settingsForm">
        <div class="setting-group">
          <label class="setting-label" data-i18n="settings.masterserver.label">
            ğŸŒ Master-Server URL
          </label>
          <input 
            type="text" 
            class="setting-input" 
            id="masterServerInput" 
            data-placeholder-i18n="settings.masterserver.placeholder"
            placeholder="http://supraball.servers.lan:8991"
            value=""
          />
          <div class="setting-hint" data-i18n="settings.masterserver.hint">
            Standard: http://supraball.servers.lan:8991
          </div>
        </div>

        <div class="setting-group">
          <label class="setting-label" style="display: flex; align-items: center; cursor: pointer;">
            <input 
              type="checkbox" 
              id="windowedModeCheckbox" 
              style="margin-right: 10px; width: 18px; height: 18px; cursor: pointer;"
            />
            <span data-i18n="settings.windowed.label">ğŸ–¥ï¸ Spiel im Fenstermodus starten</span>
          </label>
          <div class="setting-hint" data-i18n="settings.windowed.hint">
            Startet das Spiel im Fenster statt im Vollbildmodus
          </div>
        </div>

        <div class="settings-actions">
          <button type="button" class="settings-btn settings-btn-reset" id="resetBtn">
            <span data-i18n="settings.reset">ğŸ”„ ZurÃ¼cksetzen</span>
          </button>
          <button type="submit" class="settings-btn settings-btn-primary">
            <span data-i18n="settings.save">ğŸ’¾ Speichern</span>
          </button>
        </div>
      </form>
    </div>
  </div>
  
  <script src="UDKNetIDGenerator.js"></script>
  <script src="scripts/lobby-main.js"></script>
  <script>
    // Language selector functionality
    const languageSelect = document.getElementById('languageSelect');
    
    // Set current language on load
    const currentLang = getCurrentLanguage();
    languageSelect.value = currentLang;
    
    // Handle language change
    languageSelect.addEventListener('change', (e) => {
      const lang = e.target.value;
      setLanguage(lang);
      config.setLanguage(lang);
    });

    // Settings popup functionality
    const settingsBtn = document.getElementById('settingsBtn');
    const settingsOverlay = document.getElementById('settingsOverlay');
    const settingsCloseBtn = document.getElementById('settingsCloseBtn');
    const settingsForm = document.getElementById('settingsForm');
    const resetBtn = document.getElementById('resetBtn');
    const masterServerInput = document.getElementById('masterServerInput');
    const windowedModeCheckbox = document.getElementById('windowedModeCheckbox');

    // Load current settings
    masterServerInput.value = config.getMasterServerUrl();
    windowedModeCheckbox.checked = config.getWindowedMode();

    // Open settings
    settingsBtn.addEventListener('click', () => {
      settingsOverlay.classList.add('active');
      masterServerInput.value = config.getMasterServerUrl();
      windowedModeCheckbox.checked = config.getWindowedMode();
    });

    // Close settings
    settingsCloseBtn.addEventListener('click', () => {
      settingsOverlay.classList.remove('active');
    });

    // Close on overlay click
    settingsOverlay.addEventListener('click', (e) => {
      if (e.target === settingsOverlay) {
        settingsOverlay.classList.remove('active');
      }
    });

    // Save settings
    settingsForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const newUrl = masterServerInput.value.trim();
      
      if (!newUrl) {
        showError(t('settings.masterserver.required'));
        return;
      }

      config.setMasterServerUrl(newUrl);
      config.setWindowedMode(windowedModeCheckbox.checked);
      window.MASTER_SERVER_URL = newUrl;
      
      showSuccess(t('settings.save.success'));
      
      setTimeout(() => {
        location.reload();
      }, 1500);
    });

    // Reset to defaults
    resetBtn.addEventListener('click', () => {
      if (confirm(t('settings.reset.confirm'))) {
        config.reset();
        masterServerInput.value = config.getMasterServerUrl();
        windowedModeCheckbox.checked = config.getWindowedMode();
        showInfo(t('settings.reset.success'));
      }
    });

    // Close on ESC key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && settingsOverlay.classList.contains('active')) {
        settingsOverlay.classList.remove('active');
      }
    });
  </script>

  <!-- Chat Container -->
  <div class="chat-container" id="chatContainer">
    <div class="chat-header">
      <div class="chat-title">
        <span id="chatMode">ğŸ’¬ Chat</span>
      </div>
    </div>
    <div class="chat-messages" id="chatMessages">
      <div class="chat-empty">
        <div class="chat-empty-icon">ğŸ’¬</div>
        <div class="chat-empty-text">Noch keine Nachrichten</div>
      </div>
    </div>
    <div class="chat-input-container">
      <textarea 
        class="chat-input" 
        id="chatInput" 
        data-placeholder-i18n="chat.placeholder"
        placeholder="Nachricht eingeben..."
        rows="1"
        maxlength="500"
      ></textarea>
      <button class="chat-send-btn" id="chatSendBtn" title="Senden (Enter)">
        â¤
      </button>
    </div>
  </div>

  <script src="scripts/chat.js"></script>
</body>
</html>
